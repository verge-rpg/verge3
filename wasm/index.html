7<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>VERGE!</title>
    <style>
        html, body {
            padding: 0;
            margin: 0;
            width: 100%;
            height: 100%;
        }

        body {
            font-family: sans-serif;
            background-color: #0a0804;
            color: #a8a0a0;
            text-align: center;
        }

        .vergeContainer {
            width: 100%;
            height: 100%;
            position: relative;
            display: grid;
            grid-template-columns: 225px auto 225px;
            grid-template-rows: 75px auto 50px 25px;
            grid-template-areas:
                "header header header"
                "leftside playarea controls"
                "leftside loadingbar controls"
                "footer footer footer"
            ;
        }

        #canvasContainer {
            grid-area: playarea;
            align-self: stretch;
            justify-self: stretch;
            display: flex;
            align-items: center;
            justify-items: center;
        }

        canvas {
            image-rendering: pixelated;
            z-index: 999;
            margin: auto;
        }

        #loadingProgress {
            width: 624px;
            margin: auto;
            border: 4px solid gray;
            padding: 4px;
            height: 1em;
            position: relative;
            transition: opacity 2s;
            grid-area: loadingbar;
            align-self: center;
            justify-self: center;
        }

        #loadingProgress div {
            background-color: green;
            margin: 4px;
            position: absolute;
            left: 0;
            right: 100%;
            top: 0;
            bottom: 0;
        }

        #controls {
            text-align: left;
            z-index: -1;
            grid-area: controls;
            padding: 0.5em;
        }

        #no-audio-worklet {
            display: none;
        }

        header {
            font-size: 32px;
            grid-area: header;
            align-self: center;
            justify-self: center;
        }

        footer {
            font-size: 9px;
            grid-area: footer;
            align-self: center;
            justify-self: center;
        }

    </style>
</head>
<body>
    <div class="vergeContainer">
        <header>VERGE</header>
        <div id="canvasContainer">
            <canvas id="canvas" width="320" height="200"></canvas>
        </div>
        <div id='loadingProgress'><div></div></div>
        <div id='controls'>
            <h2>Controls</h2>
            <dl>
                <dt>Arrow keys</dt><dd>Move</dd>
                <dt>Enter</dt><dd>Interact, select menu options</dd>
                <dt>Tab</dt><dd>Cancel out of menus</dd>
                <dt>Space</dt><dd>Main menu (items, equipment, etc)</dd>
                <dt>ESC</dt><dd>System menu (save, load, etc)</dd>
            </dl>
            <h2>Gamepad Controls</h2>
            <dl>
                <dt>A</dt><dd>Interact</dd>
                <dt>B</dt><dd>Cancel</dd>
                <dt>Y</dt><dd>Main menu</dd>
                <dt>Start</dt><dd>System Menu</dd>
            </dl>
            <div id='no-audio-worklet'>
                Your browser does not support AudioWorklet.  We cannot play any music.  Sorry!<br />
                The latest versions of Chrome and Firefox should work!
            </div>
        </div>
        <footer id="build-date"></footer>
    </div>

    <script>
        (function() {
            const screen_size = [320, 240];
            const canvas = document.getElementById('canvas');
            const canvasContainer = canvas.parentNode;
            canvas.setAttribute('width', screen_size[0]);
            canvas.setAttribute('height', screen_size[1]);

            const resizeCallback = (e) => {
                canvas.style.display = "none";

                const parentRect = canvasContainer.getClientRects()[0];
                const scaleX = (parentRect.width / canvas.width) | 0;
                const scaleY = (parentRect.height / canvas.height) | 0;
                const scale = Math.max(Math.min(scaleX, scaleY), 1);

                canvas.style.width = (canvas.width * scale) + "px";
                canvas.style.height = (canvas.height * scale) + "px";
                canvas.style.display = "";
            };

            window.addEventListener('resize', resizeCallback);
            resizeCallback();
            window.onWindowResize = resizeCallback;

            if (!('audioWorklet' in AudioContext.prototype)) {
                document.getElementById('no-audio-worklet').style.display = 'block';
            }
        })();

        (function() {
            const ctx = document.getElementById('canvas').getContext('2d');
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, 320, 200);

            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.fillText('Loading! :D', 160, 100);
        })();
        </script>

        <!--
            DIRECTIONS:

            Have a 320x200 canvas with the id canvas.

            Define a function window.verge.setLoadingProgress.  It takes a number which describes
            the loading progress.  The application will always call setLoadingProgress with a value of
            100 when loading is complete.

            Set window.Module to {arguments: ["gameroot_dir/"]}
            The game root dir is a relative path to a manifest.txt.  This file describes all the stuff
            needed to run the game.

            Once you have done all of this, include verge3.out.js with a script tag.
        -->
        <script>
            const TIMELESS_FOLDER = 'timeless'
            const TIMELESS_PATHS = [
                "animation.vc",
                "background/bobblue.gif",
                "background/bobcyan.gif",
                "background/bobgreen.gif",
                "background/bobred.gif",
                "background/evilgd1.pcx",
                "background/evilgd2.pcx",
                "background/evilgrad.gif",
                "background/evilgrad1.gif",
                "background/evilgrad2.gif",
                "background/evilgrad3.gif",
                "background/face_blue.gif",
                "background/face_green.gif",
                "background/face_red.gif",
                "background/grad1.png",
                "background/grad2.png",
                "background/grad3.png",
                "background/grad4.png",
                "background/grad5.png",
                "background/grad6.png",
                "background/grad7.png",
                "background/lightning.gif",
                "background/sphereblue.gif",
                "background/spheregreen.gif",
                "background/spheregrey.gif",
                "background/sphereorange.gif",
                "background/spherepurple.gif",
                "background/tiledbg0.gif",
                "background/tiledbg1.gif",
                "background/tiledbg2.gif",
                "background/tiledbg3.gif",
                "background/tiledbg4.gif",
                "background/tiledbg5.gif",
                "background/tiledbg6.gif",
                "background/tiledbg7.gif",
                "background/tiledbg8.gif",
                "background/tiledbg9.gif",
                "background/_grad1.png",
                "background/_grad2.png",
                "background/_grad3.png",
                "background/_grad4.png",
                "background/_grad5.png",
                "background/_grad6.png",
                "background/_grad7.png",
                "background/_grad8.png",
                "backgrounds.txt",
                "bg.png",
                "bgr.vc",
                "bgr0.vc",
                "bgr1.vc",
                "bgr2.vc",
                "bgr3.vc",
                "bgr4.vc",
                "bgr5.vc",
                "bgr6.vc",
                "bgr6a.vc",
                "bgr6b.vc",
                "bgra.vc",
                "bgrb.vc",
                "bgrc.vc",
                "bgrd.vc",
                "lens.vc",
                "le_beneath.vc",
                "le_grey.vc",
                "le_scale.vc",
                "le_tint.vc",
                "lm_bounce.vc",
                "lm_horiz.vc",
                "lm_vert.vc",
                "manifest.txt",
                "menu.gif",
                "music/lib-grey.xm",
                "music/rain.s3m",
                "music/sully-columns.it",
                "music/verge6.it",
                "music/zcs-02-intro.xm",
                "music/zk-jdood.it",
                "prepos.txt",
                "resource.vc",
                "sprites/bigeye.gif",
                "sprites/bigeye_green.gif",
                "sprites/bigheart.gif",
                "sprites/bigsmile.gif",
                "sprites/candle.gif",
                "sprites/circle.gif",
                "sprites/ele-anti.gif",
                "sprites/ele-arse.gif",
                "sprites/ele-gold.gif",
                "sprites/ele-iron.gif",
                "sprites/ele-merc.gif",
                "sprites/ele-phos.gif",
                "sprites/ele-pota.gif",
                "sprites/ele-silv.gif",
                "sprites/ele-sulf.gif",
                "sprites/evilmask.gif",
                "sprites/fish2.gif",
                "sprites/fishie.gif",
                "sprites/flame.gif",
                "sprites/flower.gif",
                "sprites/flower_green.gif",
                "sprites/flyeye.gif",
                "sprites/flyeye_green.gif",
                "sprites/flyheart.gif",
                "sprites/flymask.gif",
                "sprites/flyskull.gif",
                "sprites/greenmoon.gif",
                "sprites/halo.png",
                "sprites/hearts.gif",
                "sprites/hourglass.gif",
                "sprites/leafie.gif",
                "sprites/leaf_green.gif",
                "sprites/moon.gif",
                "sprites/planet.gif",
                "sprites/raindrop.gif",
                "sprites/skullofawesome.gif",
                "sprites/sluggy.gif",
                "sprites/slug_brown.gif",
                "sprites/smallclock.gif",
                "sprites/smalleye.gif",
                "sprites/smalleye_green.gif",
                "sprites/smallflower.gif",
                "sprites/smallflower_green.gif",
                "sprites/smallsmile.gif",
                "sprites/smallsun.gif",
                "sprites/smallsun_green.gif",
                "sprites/smile_green.gif",
                "sprites/snow.gif",
                "sprites/sun.gif",
                "sprites/tinyeye.gif",
                "sprites/tinyeye_green.gif",
                "sprites.vc",
                "spr_candle.vc",
                "spr_celestial.vc",
                "spr_circular.vc",
                "spr_fish.vc",
                "spr_flower.vc",
                "spr_flyer.vc",
                "spr_leaves.vc",
                "spr_runes.vc",
                "spr_slug.vc",
                "spr_smilies.vc",
                "spr_weather.vc",
                "system.vc",
                "verge.cfg",
            ];

            const TEST_FOLDER = '';
            const TEST_PATHS = [
                "system.vc",
                "test.png",
                "verge.cfg",
            ];

            const WINGBLASTER_FOLDER = 'wingblaster'
            const WINGBLASTER_PATHS = [
                "background.png",
                "bigbadblocky.png",
                "blocky.png",
                "blockymad.png",
                "bosshit.wav",
                "config.exe",
                "Copy of starfield.png",
                "curvelaser.png",
                "defines.vc",
                "demo.dat",
                "demo.vc",
                "enemy.vc",
                "enemy.vc_",
                "explode.wav",
                "font_white.png",
                "framethrottle.vc",
                "hit.wav",
                "jelly1.wav",
                "laser1.png",
                "laser2.png",
                "lasr1.png",
                "lasr2.png",
                "manifest.txt",
                "masher2.png",
                "object.vc",
                "okboss.xm",
                "ovk_atan2.vc",
                "Readme.txt",
                "ripples.jpg",
                "rock.png",
                "ship.png",
                "shipbad.png",
                "shooter.vc",
                "shot.png",
                "shot.wav",
                "shuriken.png",
                "starfield.png",
                "sword2.wav",
                "system-.vc",
                "system.vc",
                "thin.png",
                "troupe_-_hourlongxplosn.s3m",
                "troupe_-_hourlongxplosn_slow'd.s3m",
                "v3.log",
                "verge.cfg",
            ];

            const HEART_FOLDER = 'heart';
            const HEART_PATHS = [
                'bottomarrow.pcx',
                'CHANGELOG.txt',
                'code/ai.vc',
                'code/animations.vc',
                'code/code.tws',
                'code/effects.vc',
                'code/effects.vh',
                'code/engine.vc',
                'code/equip.vc',
                'code/graphics.vc',
                'code/heartentity.vc',
                'code/input.vc',
                'code/intromenu.vc',
                'code/mapcapture.vc',
                'code/menu.vc',
                'code/music.vc',
                'code/naming.vc',
                'code/save.vc',
                'code/tt64_textbox.vc',
                'code/utility.vh',
                'forest_1-01.map',
                'forest_1-01.vc',
                'forest_1-02.map',
                'forest_1-02.vc',
                'forest_1-03.map',
                'forest_1-03.vc',
                'forest_1-04.map',
                'forest_1-04.vc',
                'forest_1-05.map',
                'forest_1-05.vc',
                'forest_1-06.map',
                'forest_1-06.vc',
                'forest_1-07.map',
                'forest_1-07.vc',
                'heart-enemymagic.rar',
                'heart-naming.rar',
                'heart-oggsounds.rar',
                'heart.zip',
                'images/fire.gif',
                'images/fire.png',
                'images/fireball.gif',
                'images/flame.gif',
                'images/heal.gif',
                'images/heal2.gif',
                'images/heartfill.gif',
                'images/heartvial.gif',
                'images/manafill.gif',
                'images/manavial.gif',
                'images/nova.gif',
                'images/thin.png',
                'manifest.txt',
                'mapcap.rar',
                'MapedPreferences.xml',
                'music/yfforest.it',
                'music/yftown.it',
                'music/level1.xm',
                'README.txt',
                'save00.sav',
                'save01.sav',
                'save02.sav',
                'save03.sav',
                'sounds/bubbles.ogg',
                'sounds/fireball.ogg',
                'sounds/gasp3.ogg',
                'sounds/iceshort.ogg',
                'sounds/nova.ogg',
                'sounds/punch.ogg',
                'sounds/steelsword.ogg',
                'sounds/storm.ogg',
                'sounds/wolves.ogg',
                'sprites/bold.chr',
                'sprites/braize.chr',
                'sprites/braizesword.chr',
                'sprites/dorg.chr',
                'sprites/eff.chr',
                'sprites/potions.chr',
                'sprites/shell.chr',
                'sprites/townspeople.chr',
                'system.vc',
                'thin.png',
                'TODO.txt',
                'town.map',
                'town.vc',
                'town.vsp',
                'v3.log',
                'verge.cfg',
            ]

            const SNOWBALL_FOLDER = 'snowball';
            const SNOWBALL_PATHS = [
                "ai.vc",
                "animation.vc",
                "bat.chr",
                "bat.png",
                "boy.chr",
                "boyspritesheet.png",
                "bw.map",
                "bw.vc",
                "bw.vsp",
                "Changes.txt",
                "Copy of enemy.vc",
                "credits.vc",
                "demo.dat",
                "effects.vc",
                "enemy.vc",
                "event.vc",
                "exitdoor.png",
                "finish.png",
                "font1.png",
                "framethrottle.vc",
                "gauge-green.png",
                "gauge-grey.png",
                "girl.chr",
                "girlspritesheet.png",
                "graphics.vc",
                "grasstile.png",
                "grasstile2.png",
                "hillus.map",
                "hillus.vc",
                "hudinterface.vc",
                "land.ogg",
                "land.wav",
                "level1.map",
                "level1.vc",
                "level1.xm",
                "level2.map",
                "level2.vc",
                "level3.map",
                "level3.vc",
                "levelselect.vc",
                "LevelThumbs/1.png",
                "LevelThumbs/10.png",
                "LevelThumbs/2.png",
                "LevelThumbs/3.png",
                "LevelThumbs/4.png",
                "LevelThumbs/5.png",
                "LevelThumbs/6.png",
                "LevelThumbs/7.png",
                "LevelThumbs/8.png",
                "LevelThumbs/9.png",
                "lynn.chr",
                "mainmenu.vc",
                "manifest.txt",
                "MapedPreferences.xml",
                "mountains.png",
                "obstile.png",
                "pixelfont2.png",
                "platform.vc",
                "platform1.vc",
                "Platformer.tws",
                "poof.png",
                "poof.vc",
                "pop.wav",
                "practice.map.vsp",
                "practiceny.map",
                "practiceny.map.vsp",
                "practiceny.vc",
                "protag.chr",
                "punch.ogg",
                "punch.wav",
                "README.TXT",
                "redmountains.png",
                "resourceLoad.vc",
                "resources.dat",
                "santa.chr",
                "santa.png",
                "save.dat",
                "savegame.vc",
                "sbintro.it",
                "sblevel.it",
                "sbwin.it",
                "SCRATCH.wav",
                "shing.ogg",
                "smw_kick.wav",
                "snow.png",
                "snowball-logo.png",
                "snowball-tiny.png",
                "snowball.png",
                "snowball.vh",
                "snowball.vsp",
                "snowtile.png",
                "SPLASH.ogg",
                "SPLASH.wav",
                "swing.ogg",
                "swing.wav",
                "swing2.ogg",
                "swing2.wav",
                "system.vc",
                "system.vcd",
                "temperaturemap.png",
                "test.vc",
                "thin.png",
                "unlock.wav",
                "v1_maineffects.vc",
                "v3.log",
                "vcc_verbose.txt",
                "verge.cfg",
                "walkloop.ogg",
                "walkloop.wav",
                "water.ogg",
                "weather.vc",
                "windchimes.ogg",
                "windchimes.wav",
            ];            

            MONSOON_FOLDER = 'monsoon'
            MONSOON_PATHS = [
                "code/ability.lua",
                "code/ai.lua",
                "code/box_style.lua",
                "code/controls.lua",
                "code/dialogue.lua",
                "code/direction.lua",
                "code/entity.lua",
                "code/frame_limiter.lua",
                "code/init.lua",
                "code/minimap.lua",
                "code/mungo/mungo.lua",
                "code/npc.lua",
                "code/player.lua",
                "code/progress.lua",
                "code/projectile.lua",
                "code/resources.lua",
                "code/sprite.lua",
                "code/vx/Color.lua",
                "code/vx/ColorFilter.lua",
                "code/vx/Entity.lua",
                "code/vx/File.lua",
                "code/vx/Font.lua",
                "code/vx/Image.lua",
                "code/vx/init.lua",
                "code/vx/Input.lua",
                "code/vx/Lucent.lua",
                "code/vx/Socket.lua",
                "code/vx/Song.lua",
                "code/vx/Sound.lua",
                "code/vx/String.lua",
                "code/vx/System.lua",
                "code/vx/ToString.lua",
                "code/vx/_vergeCamera.lua",
                "code/vx/_vergeClock.lua",
                "code/vx/_vergeJoystickInput.lua",
                "code/vx/_vergeKeyboardInput.lua",
                "code/vx/_vergeMap.lua",
                "code/vx/_vergeMouseInput.lua",
                "code/vx/_vergeMusic.lua",
                "manifest.txt",
                "resources/data/ability.mungo",
                "resources/data/bullet.mungo",
                "resources/fonts/thin.png",
                "resources/images/textbox_arrow.png",
                "resources/maps/MapedPreferences.xml",
                "resources/maps/molasses.lua",
                "resources/maps/molasses.map",
                "resources/maps/molasses.vsp",
                "resources/maps/molasses_tileset.png",
                "resources/sounds/ceiling_bounce.wav",
                "resources/sounds/door_close.wav",
                "resources/sounds/door_open.wav",
                "resources/sounds/explode.wav",
                "resources/sounds/explode2.wav",
                "resources/sounds/explode5.wav",
                "resources/sounds/hitwall.wav",
                "resources/sounds/hurt_enemy.wav",
                "resources/sounds/jump.wav",
                "resources/sounds/land.wav",
                "resources/sounds/land2.wav",
                "resources/sounds/land3.wav",
                "resources/sounds/notice.wav",
                "resources/sounds/shot.wav",
                "resources/sounds/shot2.wav",
                "resources/sounds/shot4.wav",
                "resources/sounds/stun_enemy.wav",
                "resources/sounds/t-gladiator.it",
                "resources/sounds/teleport.wav",
                "resources/sounds/thump.wav",
                "resources/sounds/thump2.wav",
                "resources/sounds/thump3.wav",
                "resources/sounds/__shot.wav",
                "resources/sprites/bird.png",
                "resources/sprites/bird.sprite",
                "resources/sprites/hermit.png",
                "resources/sprites/hermit.sprite",
                "resources/sprites/molasses_meow.png",
                "resources/sprites/molasses_meow.sprite",
                "resources/sprites/neon_heart.png",
                "resources/sprites/shot.sprite",
                "resources/sprites/shot2.sprite",
                "resources/sprites/shot3.sprite",
                "system.lua",
                "system.vc",
                "v3.log",
                "verge.cfg",
            ];

            TCOD_FOLDER = 'tcod_tropical';
            TCOD_PATHS = [
                "animation.vc",
                "boy1.chr",
                "boy2.chr",
                "boy3.chr",
                "coins.wav",
                "core.dump",
                "crown.pcx",
                "elliot.chr",
                "elliots.pcx",
                "green.s3m",
                "lock1.wav",
                "man.chr",
                "man1.chr",
                "man2.chr",
                "man3.chr",
                "man4.chr",
                "map.dump",
                "menumove.wav",
                "olio1.chr",
                "olio2.chr",
                "olio3.chr",
                "open2.wav",
                "pig01.wav",
                "pig1.chr",
                "pig2.chr",
                "pig3.chr",
                "ReadMe.txt",
                "seashell.pcx",
                "smallfont.pcx",
                "speech.gif",
                "stats/bluepig.txt",
                "stats/elliot.txt",
                "stats/party.txt",
                "stats/pig1.txt",
                "stats/pig3.txt",
                "story01.png",
                "story03.png",
                "story04.png",
                "story05.png",
                "story06.png",
                "system/cloud1.gif",
                "system/cloud2.gif",
                "system/cloud3.gif",
                "system/fog.png",
                "system/font1_vw.gif",
                "system/font2_vw.gif",
                "system/font3_vw.gif",
                "system/more.gif",
                "system/smallfont1.gif",
                "system/smallfont2.gif",
                "system/textbox.gif",
                "system/textbox2.gif",
                "system/v3font.gif",
                "system/wipe.gif",
                "system/wipe2.gif",
                "system.vc",
                "title01.png",
                "trefus.it",
                "tropic.map",
                "tropic.vc",
                "tropic.vsp",
                "tropic_ints.txt",
                "v1_maineffects.vc",
                "v1_rpg.vc",
                "v1_weather.vc",
                "v3.log",
                "v3changes.txt",
                "v3vergec.txt",
                "vcc_verbose.txt",
                "verge.cfg",
                "wind2.wav",
                "woman1.chr",
                "woman2.chr",
                "woman3.chr",
            ];

            const LEXICO_FOLDER = 'lexico';
            const LEXICO_PATHS = [
                "0-0.map",
                "0-1.map",
                "0-2.map",
                "0-3.map",
                "0-4.map",
                "1-1.map",
                "1-1.vsp",
                "1-2.map",
                "1-3.map",
                "1-4.map",
                "1-5.map",
                "1-6.map",
                "1-7.map",
                "1-8.map",
                "2-1.map",
                "2-1.vsp",
                "2-2.map",
                "2-3.map",
                "2-4.map",
                "2-5.map",
                "3-1.map",
                "3-1.vsp",
                "3-2.map",
                "3-3.map",
                "3-4.map",
                "banner.png",
                "batteryroom.txt",
                "button.bmp",
                "button.png",
                "button_down.png",
                "button_over.png",
                "crane.chr",
                "crane_shadow.png",
                "crate.chr",
                "crate2.chr",
                "crate_hi.chr",
                "c_arrow.png",
                "drill.chr",
                "dummy.chr",
                "EEE.map",
                "elder.chr",
                "fonts/font0.png",
                "glyphs/glyph01.png",
                "glyphs/glyph01g.png",
                "glyphs/glyph01y.png",
                "glyphs/glyph02.png",
                "glyphs/glyph02g.png",
                "glyphs/glyph02y.png",
                "glyphs/glyph03.png",
                "glyphs/glyph03g.png",
                "glyphs/glyph03y.png",
                "glyphs/glyph04.png",
                "glyphs/glyph04g.png",
                "glyphs/glyph04y.png",
                "glyphs/glyph05.png",
                "glyphs/glyph05g.png",
                "glyphs/glyph05y.png",
                "glyphs/glyph06.png",
                "glyphs/glyph06g.png",
                "glyphs/glyph06y.png",
                "glyphs/glyph07.png",
                "glyphs/glyph07g.png",
                "glyphs/glyph07y.png",
                "glyphs/glyph08.png",
                "glyphs/glyph08g.png",
                "glyphs/glyph08y.png",
                "glyphs/glyph09.png",
                "glyphs/glyph09g.png",
                "glyphs/glyph09y.png",
                "glyphs/glyph10.png",
                "glyphs/glyph10g.png",
                "glyphs/glyph10y.png",
                "glyphs/glyph11.png",
                "glyphs/glyph11g.png",
                "glyphs/glyph11y.png",
                "glyphs/glyph12.png",
                "glyphs/glyph12g.png",
                "glyphs/glyph12y.png",
                "glyphs/glyph13.png",
                "glyphs/glyph13g.png",
                "glyphs/glyph13y.png",
                "glyphs/glyph14.png",
                "glyphs/glyph14g.png",
                "glyphs/glyph14y.png",
                "glyphs/glyph15.png",
                "glyphs/glyph15g.png",
                "glyphs/glyph15y.png",
                "glyphs/glyph16.png",
                "glyphs/glyph16g.png",
                "glyphs/glyph16y.png",
                "glyphs/glyph17.png",
                "glyphs/glyph17g.png",
                "glyphs/glyph17y.png",
                "glyphs/glyph18.png",
                "glyphs/glyph18g.png",
                "glyphs/glyph18y.png",
                "glyphs/glyph19.png",
                "glyphs/glyph19g.png",
                "glyphs/glyph19y.png",
                "glyphs/glyph20.png",
                "glyphs/glyph20g.png",
                "glyphs/glyph20y.png",
                "glyphs/glyph21.png",
                "glyphs/glyph21g.png",
                "glyphs/glyph21y.png",
                "glyphs/glyph22.png",
                "glyphs/glyph22g.png",
                "glyphs/glyph22y.png",
                "glyphs/glyph23.png",
                "glyphs/glyph23g.png",
                "glyphs/glyph23y.png",
                "glyphs/glyph24.png",
                "glyphs/glyph24g.png",
                "glyphs/glyph24y.png",
                "glyphs/glyph25.png",
                "glyphs/glyph25g.png",
                "glyphs/glyph25y.png",
                "glyphs/glyph26.png",
                "glyphs/glyph26g.png",
                "glyphs/glyph26y.png",
                "glyphs/glyph27.png",
                "glyphs/glyph27g.png",
                "glyphs/glyph27y.png",
                "glyphs/glyph28.png",
                "glyphs/glyph28g.png",
                "glyphs/glyph28y.png",
                "glyphs/glyph29.png",
                "glyphs/glyph29g.png",
                "glyphs/glyph29y.png",
                "glyphs/glyph30.png",
                "glyphs/glyph30g.png",
                "glyphs/glyph30y.png",
                "glyphs/glyph31.png",
                "glyphs/glyph31g.png",
                "glyphs/glyph31y.png",
                "glyphs/glyph32.png",
                "glyphs/glyph32g.png",
                "glyphs/glyph32y.png",
                "glyphs/glyph33.png",
                "glyphs/glyph33g.png",
                "glyphs/glyph33y.png",
                "glyphs/glyph34.png",
                "glyphs/glyph34g.png",
                "glyphs/glyph34y.png",
                "glyphs/glyph35.png",
                "glyphs/glyph35g.png",
                "glyphs/glyph35y.png",
                "glyphs/glyph36.png",
                "glyphs/glyph36g.png",
                "glyphs/glyph36y.png",
                "glyphs/glyph37.png",
                "glyphs/glyph37g.png",
                "glyphs/glyph37y.png",
                "glyphs/glyph38.png",
                "glyphs/glyph38g.png",
                "glyphs/glyph38y.png",
                "glyphs/glyph39.png",
                "glyphs/glyph39g.png",
                "glyphs/glyph39y.png",
                "hippyf1.chr",
                "hippym1.chr",
                "lexico.png",
                "minimaps/0-0.png",
                "minimaps/0-1.png",
                "minimaps/0-2.png",
                "minimaps/0-3.png",
                "minimaps/0-4.png",
                "minimaps/1-1.png",
                "minimaps/1-2.png",
                "minimaps/1-3.png",
                "minimaps/1-4.png",
                "minimaps/1-5.png",
                "minimaps/1-6.png",
                "minimaps/1-7.png",
                "minimaps/1-8.png",
                "minimaps/2-1.png",
                "minimaps/2-2.png",
                "minimaps/2-3.png",
                "minimaps/2-4.png",
                "minimaps/2-5.png",
                "minimaps/3-1.png",
                "minimaps/3-2.png",
                "minimaps/3-3.png",
                "minimaps/3-4.png",
                "minimaps/back.png",
                "minimaps/EEE.png",
                "mouse.png",
                "mouse_outline.png",
                "music/ambient.mp3",
                "music/beep.wav",
                "music/beep2.wav",
                "music/beep3.wav",
                "music/beep4.wav",
                "music/camera_clicks.wav",
                "music/click.wav",
                "music/computerRoom.mp3",
                "music/conveyorloop.mp3",
                "music/credits.mp3",
                "music/doorclose.wav",
                "music/dooropen1.wav",
                "music/hiss.wav",
                "music/industry004.wav",
                "music/manufacturing.mp3",
                "music/softclick.wav",
                "music/steps.wav",
                "music/title.mp3",
                "music/type.wav",
                "music/warp01.wav",
                "music/warp02.wav",
                "readme.txt",
                "right.png",
                "save1.sav",
                "sbutton.png",
                "sbutton_down.png",
                "sbutton_over.png",
                "0-0.vc",
                "0-1.vc",
                "0-2.vc",
                "0-3.vc",
                "0-4.vc",
                "1-1.vc",
                "1-2.vc",
                "1-3.vc",
                "1-4.vc",
                "1-5.vc",
                "1-6.vc",
                "1-7.vc",
                "1-8.vc",
                "2-1.vc",
                "2-2.vc",
                "2-3.vc",
                "2-4.vc",
                "2-5.vc",
                "3-1.vc",
                "3-2.vc",
                "3-3.vc",
                "3-4.vc",
                "camera.vc",
                "collision.vc",
                "credits.vc",
                "door.vc",
                "EEE.vc",
                "entity.vc",
                "flags.vc",
                "fl_keyboard.vc",
                "fl_text.vc",
                "glyph.vc",
                "gui.vc",
                "menu.vc",
                "music.vc",
                "process.vc",
                "save.vc",
                "system.vc",
                "tbox.vc",
                "tboxaux.vc",
                "test.vc",
                "title.vc",
                "ui.vc",
                "ui2.vc",
                "spaceman.chr",
                "spaceman.png",
                "system.xvc",
                "tbox.png",
                "tbox2.png",
                "temperature_bar.png",
                "temperature_button.bmp",
                "test.map",
                "tiles.PNG",
                "tiles2.PNG",
                "tiles3.PNG",
                "title.map",
                "title.png",
                "verge.cfg",
                "wrong.png",
            ];

            let filesToFetch = 0;
            let fetchedSources = [];

            function fetchSources(folder, paths, completeCallback) {
                fetchedSources = [];

                for (let i = 0; i < paths.length; i++) {
                    ;((i) => {
                        const path = paths[i];
                        const dirname = getDirectoryName(path);
                        const filename = getBaseName(path);

                        console.log('fetching ' + path);

                        filesToFetch++;
                        fetchedSources.push(null);

                        fetch((folder !== '' ? folder + '/' : '') + path)
                            .then(response => response.arrayBuffer())
                            .then(result => {
                                console.log('fetched ' + path + ' ' + result);
                                fetchedSources[i] = {
                                    path: path,
                                    data: new Uint8Array(result),
                                }

                                onFetchedFile(completeCallback);
                            })
                            .catch(err => console.log(err));
                    })(i);
                }
            }

            function onFetchedFile(completeCallback) {
                filesToFetch--;

                if (filesToFetch == 0) {
                    console.log('done');
                    completeCallback(fetchedSources);
                }
            }

            function getDirectoryName(path) {
                const pieces = path.split('/');
                return pieces.length > 1
                    ? pieces.slice(0, pieces.length - 1).join('/')
                    : '.';
            }

            function getBaseName(path) {
                const pieces = path.split('/');
                return pieces.length > 0 ? pieces[pieces.length - 1] : '';
            }

            window.verge = {};

            const verge = window.verge;
            const canvas = document.getElementById('canvas');

            verge.setBuildDate = function(date) {
                document.getElementById('build-date').innerText = `Last Updated ${date}`;
            };

            verge.setLoadingProgress = function(percent) {
                const div = document.querySelector('#loadingProgress div');
                div.style.right = (100 - percent) + '%';
                if (percent == 100) {
                    setTimeout(() => document.getElementById('loadingProgress').style.opacity = '0', 1000);
                }
            };

            let clickedOnce = false;
            const u = new URLSearchParams(window.location.search);
            const game = u.get('game') || 'timeless';
            //const folder = LEXICO_FOLDER;
            //const paths = LEXICO_PATHS;
            //const folder = TCOD_FOLDER;
            //const paths = TCOD_PATHS;
            //const folder = HEART_FOLDER;
            //const paths = HEART_PATHS;
            const folder = SNOWBALL_FOLDER;
            const paths = SNOWBALL_PATHS;
            //const folder = TIMELESS_FOLDER;
            //const paths = TIMELESS_PATHS;

            canvas.onclick = event => { clickedOnce = true; }

            window.Module = {
                //arguments: [game + '/']
                print: msg => console.log(msg),
                printErr: msg => console.log(msg),
                arguments: [],
                canvas: canvas,
                preRun: function() {
                    window.Module.addRunDependency('vc_source');

                    const completeCallback = sources => {
                        console.log('passing sources to emscripten');
                        let dirLevelsToCreate = [];

                        for (const source of sources) {
                            const pieces = getDirectoryName(source.path).split('/');
                            while (dirLevelsToCreate.length < pieces.length) {
                                dirLevelsToCreate.push({});
                            }

                            for (let level = 0; level < pieces.length; level++) {
                                const subpath = pieces.slice(0, level + 1).join('/');
                                dirLevelsToCreate[level][subpath] = subpath;
                            }
                        }

                        for (const dirsToCreate of dirLevelsToCreate) {
                            for (const path in dirsToCreate) {
                                console.log('adding ' + path);
                                window.Module.FS_createPath('.', path, true, true);
                            }
                        }                        

                        for (const source of sources) {
                            const path = source.path;
                            const dirname = getDirectoryName(path);
                            const filename = getBaseName(path);
                            window.Module.FS_createDataFile(dirname, filename, source.data, true, true);
                        }

                        console.log("found mpt? = ", foundMPT);

                        const ctx = document.getElementById('canvas').getContext('2d');
                        ctx.fillStyle = 'green';
                        ctx.fillRect(0, 0, 320, 200);

                        ctx.fillStyle = 'white';
                        ctx.textAlign = 'center';
                        ctx.fillText('Click to start! :D', 160, 100);

                        let interval = setInterval(() => {
                            if (clickedOnce) {
                                window.Module.removeRunDependency('vc_source');

                                window.clearInterval(interval);
                            }
                        }, 1000);
                    };

                    let foundMPT = false;
                    filesToFetch++;
                    fetch('mpt-worklet.js')
                        .then(response => response.text())
                        .then(result => {
                            console.warn('fetched mpt-worklet');
                            foundMPT = true;
                            onFetchedFile(completeCallback);
                        })
                        .catch(err => console.warn(err));

                    fetchSources(folder, paths, completeCallback);
                },
            };

            if (u.get("statCheat") > 0) {
                window.Module.arguments.push('statCheat');
            }
        </script>
        <script async type="text/javascript" src="verge3.out.js"></script>
</body>
</html>
